<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.47">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ravi Shankar">

<title>scalable_data_architectures – Data Down To Earth</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../logo.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<link rel="stylesheet" href="../../content.css">
<meta property="og:title" content="– Data Down To Earth">
<meta property="og:site_name" content="Data Down To Earth">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Data Down To Earth</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../../../projects/dsml_projects.html">
 <span class="dropdown-text">Data Science and ML Projects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../projects/genai_projects.html">
 <span class="dropdown-text">Generative AI Projects</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../../../topics/statistics.html">
 <span class="dropdown-text">Statistics &amp; Probability</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../topics/machine_learning.html">
 <span class="dropdown-text">Machine Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../topics/de.html">
 <span class="dropdown-text">Data Engineering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../topics/generative_ai.html">
 <span class="dropdown-text">Generative AI</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../topics/public_health.html">
 <span class="dropdown-text">Public Health</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../topics/product_sense.html">
 <span class="dropdown-text">Product Sense</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../blogs/blogs.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/iamrsps"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/iamravishankar/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
</div>



<div class="quarto-title-meta column-page">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ravi Shankar </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="chapter-13-scalable-data-architectures" class="level1 text-content">
<h1>Chapter 13: Scalable Data Architectures</h1>
<section id="lambda-architecture" class="level2">
<h2 class="anchored" data-anchor-id="lambda-architecture">Lambda Architecture</h2>
<section id="definition" class="level3">
<h3 class="anchored" data-anchor-id="definition">Definition</h3>
<p>Lambda architecture is a data processing architecture designed to handle massive quantities of data by leveraging both batch and real-time processing methods. It aims to balance latency, throughput, and fault-tolerance by combining the strengths of batch and stream processing.</p>
</section>
<section id="components" class="level3">
<h3 class="anchored" data-anchor-id="components">Components</h3>
<ul>
<li><p><strong>Batch Layer</strong>: Processes and stores large volumes of historical data, providing the system with comprehensive views and the ability to perform large-scale, high-latency computations. It uses technologies such as Hadoop and Spark.</p></li>
<li><p><strong>Speed Layer</strong>: Handles real-time data processing with low latency, offering immediate views of data as it flows into the system. Technologies like Apache Storm, Apache Flink, or Spark Streaming are commonly used.</p></li>
<li><p><strong>Serving Layer</strong>: Combines outputs from both the batch and speed layers to provide a unified view of the data, making it accessible for querying and analysis. Technologies like HBase, Cassandra, or Elasticsearch are often used in this layer.</p></li>
</ul>
</section>
<section id="advantages" class="level3">
<h3 class="anchored" data-anchor-id="advantages">Advantages</h3>
<p>Combines the robustness of batch processing with the immediacy of stream processing, ensuring comprehensive data analysis and real-time insights.</p>
</section>
<section id="challenges" class="level3">
<h3 class="anchored" data-anchor-id="challenges">Challenges</h3>
<p>Maintaining two separate processing pathways can increase complexity and operational overhead. Data consistency and integration between batch and speed layers must be carefully managed.</p>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>An e-commerce platform uses Lambda architecture to process historical sales data in the batch layer for trend analysis and uses the speed layer to provide real-time inventory updates and customer activity tracking.</p>
<hr>
</section>
</section>
<section id="kappa-architecture" class="level2">
<h2 class="anchored" data-anchor-id="kappa-architecture">Kappa Architecture</h2>
<section id="definition-1" class="level3">
<h3 class="anchored" data-anchor-id="definition-1">Definition</h3>
<p>Kappa architecture is a simplified version of the Lambda architecture that processes all data as a real-time stream. It eliminates the batch layer, relying entirely on stream processing to handle data ingestion, processing, and querying.</p>
</section>
<section id="components-1" class="level3">
<h3 class="anchored" data-anchor-id="components-1">Components</h3>
<ul>
<li><p><strong>Stream Processing Engine</strong>: Handles continuous data ingestion and real-time processing. Technologies like Apache Kafka, Apache Flink, or Apache Samza are commonly used.</p></li>
<li><p><strong>Serving Layer</strong>: Stores processed data and makes it available for querying and analysis. This layer typically uses distributed databases such as Cassandra, Elasticsearch, or a time-series database like InfluxDB.</p></li>
</ul>
</section>
<section id="advantages-1" class="level3">
<h3 class="anchored" data-anchor-id="advantages-1">Advantages</h3>
<p>Reduces system complexity by removing the need for a batch processing layer. Provides real-time data processing and insights with lower latency.</p>
</section>
<section id="challenges-1" class="level3">
<h3 class="anchored" data-anchor-id="challenges-1">Challenges</h3>
<p>May not be suitable for scenarios requiring extensive historical data processing or complex, high-latency computations. Stream processing systems must be highly reliable and capable of handling large volumes of data continuously.</p>
</section>
<section id="example-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1">Example</h3>
<p>A social media platform uses Kappa architecture to process user interactions in real-time, updating user feeds and notifications instantly without relying on batch processing for historical data analysis.</p>
<hr>
</section>
</section>
<section id="delta-architecture" class="level2">
<h2 class="anchored" data-anchor-id="delta-architecture">Delta Architecture</h2>
<section id="definition-2" class="level3">
<h3 class="anchored" data-anchor-id="definition-2">Definition</h3>
<p>Delta architecture combines elements of both Lambda and Kappa architectures, emphasizing the unification of batch and stream processing within a single framework. It uses a single storage layer to manage both real-time and historical data.</p>
</section>
<section id="components-2" class="level3">
<h3 class="anchored" data-anchor-id="components-2">Components</h3>
<ul>
<li><p><strong>Delta Lake</strong>: A storage layer that provides ACID transactions, scalable metadata handling, and unifies streaming and batch data processing. Delta Lake is often built on top of data lakes such as AWS S3 or Azure Data Lake Storage.</p></li>
<li><p><strong>Unified Data Processing</strong>: Uses a single processing framework, such as Apache Spark or Apache Flink, to handle both real-time streaming data and batch processing jobs. This approach simplifies data engineering workflows and reduces system complexity.</p></li>
<li><p><strong>Serving Layer</strong>: Stores and serves the processed data for querying and analysis. Technologies like Delta Lake or similar can provide robust querying capabilities with low latency and high throughput.</p></li>
</ul>
</section>
<section id="advantages-2" class="level3">
<h3 class="anchored" data-anchor-id="advantages-2">Advantages</h3>
<p>Simplifies data architecture by unifying batch and stream processing into a single framework. Reduces operational overhead and improves consistency across different types of data processing workloads.</p>
</section>
<section id="challenges-2" class="level3">
<h3 class="anchored" data-anchor-id="challenges-2">Challenges</h3>
<p>Requires careful design to ensure that the unified processing framework can handle the diverse needs of both real-time and batch processing. Ensuring data consistency and correctness in a unified architecture can be complex.</p>
</section>
<section id="example-2" class="level3">
<h3 class="anchored" data-anchor-id="example-2">Example</h3>
<p>A financial services company uses Delta architecture to process transaction data in real-time for fraud detection while also performing nightly batch analysis for regulatory reporting and compliance, all within a unified framework using Delta Lake and Apache Spark.</p>
<hr>
</section>
</section>
<section id="microservices-in-data-engineering" class="level2">
<h2 class="anchored" data-anchor-id="microservices-in-data-engineering">Microservices in Data Engineering</h2>
<section id="definition-3" class="level3">
<h3 class="anchored" data-anchor-id="definition-3">Definition</h3>
<p>Microservices architecture involves breaking down a large, monolithic application into smaller, independent services that can be developed, deployed, and scaled independently. In data engineering, this approach applies to building data processing and analytics systems as a collection of loosely coupled services.</p>
</section>
<section id="components-3" class="level3">
<h3 class="anchored" data-anchor-id="components-3">Components</h3>
<ul>
<li><p><strong>Independent Services</strong>: Each service is responsible for a specific piece of functionality, such as data ingestion, transformation, or querying. Services communicate through APIs or messaging systems like Kafka or RabbitMQ.</p></li>
<li><p><strong>Containerization</strong>: Services are often deployed in containers (e.g., Docker) to ensure consistency across environments and simplify deployment and scaling. Orchestration tools like Kubernetes manage containerized services.</p></li>
<li><p><strong>Decentralized Data Management</strong>: Data is managed by individual services, each owning its own data store. This allows for flexibility in choosing the best storage solution for each service’s requirements (e.g., SQL, NoSQL, in-memory databases).</p></li>
</ul>
</section>
<section id="advantages-3" class="level3">
<h3 class="anchored" data-anchor-id="advantages-3">Advantages</h3>
<p>Enables independent development, deployment, and scaling of services, improving agility and resilience. Promotes the use of the best-fit technology for each service, enhancing performance and maintainability.</p>
</section>
<section id="challenges-3" class="level3">
<h3 class="anchored" data-anchor-id="challenges-3">Challenges</h3>
<p>Requires robust inter-service communication and coordination. Managing distributed data and ensuring consistency across services can be complex. Monitoring and maintaining a large number of services can be challenging.</p>
</section>
<section id="example-3" class="level3">
<h3 class="anchored" data-anchor-id="example-3">Example</h3>
<p>A streaming platform uses microservices to handle different aspects of data processing, such as video ingestion, transcoding, user activity tracking, and recommendation engine. Each service can be scaled independently based on demand.</p>
<hr>
</section>
</section>
<section id="event-driven-architectures" class="level2">
<h2 class="anchored" data-anchor-id="event-driven-architectures">Event-Driven Architectures</h2>
<section id="definition-4" class="level3">
<h3 class="anchored" data-anchor-id="definition-4">Definition</h3>
<p>Event-driven architecture (EDA) is a design paradigm in which the flow of the program is determined by events such as user actions, sensor outputs, or messages from other programs. EDA is particularly effective in building scalable, real-time data processing systems.</p>
</section>
<section id="components-4" class="level3">
<h3 class="anchored" data-anchor-id="components-4">Components</h3>
<ul>
<li><p><strong>Event Producers</strong>: Generate events that trigger actions within the system. Producers can be user interfaces, sensors, or other applications.</p></li>
<li><p><strong>Event Consumers</strong>: Receive and process events, performing tasks or triggering further events. Consumers can be microservices, databases, or data processing engines.</p></li>
<li><p><strong>Event Brokers</strong>: Manage the distribution of events between producers and consumers, ensuring reliable and scalable event handling. Common event brokers include Apache Kafka, RabbitMQ, and AWS SNS/SQS.</p></li>
</ul>
</section>
<section id="advantages-4" class="level3">
<h3 class="anchored" data-anchor-id="advantages-4">Advantages</h3>
<p>Supports real-time processing and responsiveness, enables decoupling of system components, and scales efficiently to handle varying workloads. Promotes flexibility and adaptability in system design.</p>
</section>
<section id="challenges-4" class="level3">
<h3 class="anchored" data-anchor-id="challenges-4">Challenges</h3>
<p>Ensuring event delivery and handling failure scenarios requires careful design. Managing the order and consistency of events can be complex. Monitoring and debugging event-driven systems can be challenging.</p>
</section>
<section id="example-4" class="level3">
<h3 class="anchored" data-anchor-id="example-4">Example</h3>
<p>An online shopping platform uses event-driven architecture to handle customer actions such as placing orders, updating inventory, and processing payments. Events generated by user actions trigger corresponding services to process the events and update the system in real-time.</p>
<hr>
</section>
</section>
<section id="polyglot-persistence" class="level2">
<h2 class="anchored" data-anchor-id="polyglot-persistence">Polyglot Persistence</h2>
<section id="definition-5" class="level3">
<h3 class="anchored" data-anchor-id="definition-5">Definition</h3>
<p>Polyglot persistence refers to the use of multiple, different data storage technologies within the same application or system, leveraging the strengths of each to handle different types of data and workloads effectively.</p>
</section>
<section id="components-5" class="level3">
<h3 class="anchored" data-anchor-id="components-5">Components</h3>
<ul>
<li><p><strong>Heterogeneous Data Stores</strong>: Different databases are used for different purposes, such as relational databases for structured data, NoSQL databases for unstructured data, and in-memory databases for high-speed access.</p></li>
<li><p><strong>Data Access Layer</strong>: An abstraction layer that manages interactions with various data stores, providing a unified interface for the application to access data, regardless of the underlying storage technology.</p></li>
<li><p><strong>Data Integration</strong>: Techniques and tools to integrate and synchronize data across multiple databases, ensuring consistency and enabling comprehensive data analysis and reporting.</p></li>
</ul>
</section>
<section id="advantages-5" class="level3">
<h3 class="anchored" data-anchor-id="advantages-5">Advantages</h3>
<p>Allows the use of the best-fit technology for each data type and workload, optimizing performance, scalability, and maintainability. Provides flexibility to adapt to changing data requirements.</p>
</section>
<section id="challenges-5" class="level3">
<h3 class="anchored" data-anchor-id="challenges-5">Challenges</h3>
<p>Managing and integrating multiple databases can be complex and require specialized skills. Ensuring data consistency and handling transactions across different data stores can be challenging.</p>
</section>
<section id="example-5" class="level3">
<h3 class="anchored" data-anchor-id="example-5">Example</h3>
<p>A retail application uses a relational database (MySQL) for transactional data, a NoSQL database (MongoDB) for customer profiles and product catalogs, and an in-memory database (Redis) for session management and caching, leveraging the strengths of each technology.</p>
<hr>
</section>
</section>
<section id="data-mesh-principles-and-implementation" class="level2">
<h2 class="anchored" data-anchor-id="data-mesh-principles-and-implementation">Data Mesh Principles and Implementation</h2>
<section id="definition-6" class="level3">
<h3 class="anchored" data-anchor-id="definition-6">Definition</h3>
<p>Data Mesh is a decentralized data architecture paradigm that treats data as a product and assigns responsibility for data to domain-specific teams, promoting ownership, quality, and accessibility. It aims to overcome the limitations of centralized data architectures and improve scalability and agility in data management.</p>
</section>
<section id="principles" class="level3">
<h3 class="anchored" data-anchor-id="principles">Principles</h3>
<ul>
<li><p><strong>Domain-Oriented Ownership</strong>: Data ownership is distributed across domain teams, each responsible for the data within their domain. This promotes accountability and domain expertise in data management.</p></li>
<li><p><strong>Data as a Product</strong>: Data is treated as a product, with clear ownership, defined quality standards, and user-centric design. Data product owners ensure that data is reliable, accessible, and valuable to consumers.</p></li>
<li><p><strong>Self-Serve Data Infrastructure</strong>: Provides domain teams with the tools and platforms they need to manage and process their data independently. This includes data storage, processing, integration, and governance tools that are easy to use and scalable.</p></li>
<li><p><strong>Federated Computational Governance</strong>: Implements governance policies and standards in a federated manner, allowing domain teams to operate independently while ensuring compliance with overarching guidelines and regulations. This includes metadata management, data quality metrics, and access controls.</p></li>
</ul>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<ul>
<li><p><strong>Organizational Alignment</strong>: Align the organization around domain-oriented teams, each with the autonomy to manage their data products. Define roles and responsibilities, including data product owners, engineers, and stewards.</p></li>
<li><p><strong>Technology Stack</strong>: Deploy a technology stack that supports decentralized data management, including data lakes, data warehouses, streaming platforms, and data integration tools. Ensure interoperability and scalability across the infrastructure.</p></li>
<li><p><strong>Data Governance Framework</strong>: Establish a governance framework that balances central oversight with domain autonomy. Implement data catalogs, lineage tracking, quality monitoring, and security controls to maintain data integrity and compliance.</p></li>
<li><p><strong>Cultural Shift</strong>: Foster a culture of collaboration, continuous improvement, and innovation. Encourage teams to take ownership of their data products, share best practices, and leverage collective expertise to drive data-driven decision-making.</p></li>
</ul>
</section>
<section id="example-6" class="level3">
<h3 class="anchored" data-anchor-id="example-6">Example</h3>
<p>A global e-commerce company implements Data Mesh by organizing teams around domains such as customer data, product data, and order data. Each team manages their data products, ensuring high-quality, reliable data that is easily accessible to other teams and stakeholders. A centralized governance framework ensures compliance with data privacy regulations and company-wide data standards.</p>
</section>
</section>
</section>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>